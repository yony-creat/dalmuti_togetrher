<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ë‹¬ë¬´í‹° - ë‹¤ì´ë ‰íŠ¸ ì—°ê²°</title>
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <style>
        :root { --bg-color: #1a252f; --accent: #f1c40f; }
        body { font-family: 'Malgun Gothic', sans-serif; background-color: var(--bg-color); color: white; margin: 0; padding: 10px; text-align: center; }
        .screen { background: rgba(0,0,0,0.5); padding: 20px; border-radius: 15px; max-width: 500px; margin: 10px auto; border: 1px solid #34495e; }
        button { padding: 12px 20px; border-radius: 8px; border: none; background: #e67e22; color: white; font-weight: bold; cursor: pointer; margin: 5px; font-size: 16px; width: 85%; }
        #status-bar { padding: 12px; margin-bottom: 15px; border-radius: 10px; font-size: 14px; background: #c0392b; font-weight: bold; }
        .online { background: #27ae60 !important; }
        .hidden { display: none; }
    </style>
</head>
<body>
    <h2 style="color:var(--accent)">ğŸ° ë‹¬ë¬´í‹° (ë‹¤ì´ë ‰íŠ¸)</h2>
    <div id="status-bar">ğŸ“¡ ì‹ í˜¸ê¸° ì¼œëŠ” ì¤‘...</div>

    <div id="setup-screen" class="screen">
        <div id="host-view">
            <button onclick="createRoom()">â• ë°©ì¥ìœ¼ë¡œ ê²Œì„ ì‹œì‘</button>
        </div>
        <div id="join-view" class="hidden">
            <p style="color:var(--accent)">ì§€ì—°ë‹˜ì´ ë³´ë‚´ì¤€ ë§í¬ë¡œ ì ‘ì†í•˜ì…¨ë‚˜ìš”?</p>
            <input type="text" id="my-name" placeholder="ë‚´ ì´ë¦„ ì…ë ¥" style="padding:10px; width:80%; margin-bottom:10px;">
            <button onclick="joinRoom()">ê²Œì„ ì…ì¥</button>
        </div>
    </div>

    <div id="lobby-screen" class="screen hidden">
        <p>ğŸ”— ì•„ë˜ ì£¼ì†Œë¥¼ ë³µì‚¬í•´ì„œ ì§€ì—°ë‹˜ê»˜ ë³´ë‚´ì„¸ìš”!</p>
        <div id="invite-url" style="background:#000; padding:10px; font-size:12px; word-break:break-all; margin-bottom:10px; cursor:pointer;" onclick="copyLink()"></div>
        <div id="players"></div>
    </div>

<script>
    const sb = document.getElementById('status-bar');
    let peer, conn, myId;
    const urlParams = new URLSearchParams(window.location.search);
    const targetRoom = urlParams.get('room');

    // 1. ì‹ í˜¸ê¸°(Peer) ì´ˆê¸°í™”
    peer = new Peer();

    peer.on('open', (id) => {
        myId = id;
        sb.innerText = "ğŸŸ¢ ì‹ í˜¸ ì¤€ë¹„ ì™„ë£Œ";
        sb.classList.add('online');
        if(targetRoom) {
            document.getElementById('host-view').classList.add('hidden');
            document.getElementById('join-view').classList.remove('hidden');
        }
    });

    // 2. ë°© ë§Œë“¤ê¸° (Host)
    function createRoom() {
        const link = window.location.origin + window.location.pathname + "?room=" + myId;
        document.getElementById('invite-url').innerText = link;
        document.getElementById('setup-screen').classList.add('hidden');
        document.getElementById('lobby-screen').classList.remove('hidden');
        
        peer.on('connection', (c) => {
            conn = c;
            conn.on('open', () => {
                document.getElementById('players').innerHTML += "ğŸ‘¤ ì§€ì—°ë‹˜ì´ ì ‘ì†í–ˆìŠµë‹ˆë‹¤!<br>";
                conn.send({type: 'welcome', msg: 'ì•ˆë…•! ì§€ì—°ì•„!'});
            });
        });
    }

    // 3. ì°¸ì—¬í•˜ê¸° (Guest)
    function joinRoom() {
        const name = document.getElementById('my-name').value;
        conn = peer.connect(targetRoom);
        conn.on('open', () => {
            sb.innerText = "ğŸŸ¢ ì§€ì—°ë‹˜ê³¼ ì—°ê²° ì„±ê³µ!";
            document.getElementById('setup-screen').innerHTML = "<h3>ğŸ° ì—°ê²° ì„±ê³µ!</h3><p>ì•„ë¹ ì™€ ëŒ€í™”ë¥¼ ì‹œì‘í•©ë‹ˆë‹¤.</p>";
        });
        conn.on('data', (data) => {
            alert("ì•„ë¹ ë¡œë¶€í„° ì˜¨ ë©”ì‹œì§€: " + data.msg);
        });
    }

    function copyLink() {
        navigator.clipboard.writeText(document.getElementById('invite-url').innerText);
        alert("ë§í¬ ë³µì‚¬ ì™„ë£Œ!");
    }
</script>
</body>
</html>
